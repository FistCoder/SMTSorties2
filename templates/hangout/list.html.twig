{% extends 'base.html.twig' %}

{% block body %}
    <div>

        <details style="background-color: #e2e2e2; padding: 6px; border-radius: 6px" class="filters accordion">
            <summary>Filtres</summary>
            <div style="padding: 6px; border-radius: 6px" >
                {{ form_start(filterForm) }}
                <div class="grid">
                    <div>
                        {{ form_row(filterForm.campus) }}
                        {{ form_row(filterForm.name) }}
                        {{ form_row(filterForm.start) }}
                        {{ form_row(filterForm.end) }}
                    </div>
                    <div class="checkboxes">
                        {{ form_row(filterForm.isOrganizer) }}
                        {{ form_row(filterForm.isRegistered) }}
                        {{ form_row(filterForm.isNotRegistered) }}
                        {{ form_row(filterForm.isPast) }}<br>
                        <button type="submit"  style="width: 40%">Rechercher</button>
                    </div>
                </div>
                {{ form_end(filterForm) }}
            </div>
        </details>

        <div >
            <a href="{{ path('hangout_add') }}">
                <button >Créer une sortie</button>
            </a>
        </div>

        <h2>Résultats des sorties filtrées</h2>

        <table class="striped">
            <thead>
            <tr>
                <th>Nom de la sortie</th>
                <th>Date de la sortie</th>
                <th>Clôture</th>
                <th>Inscrits/Places</th>
                <th>État</th>
                <th>Inscrit</th>
                <th>Organisateur</th>
                <th>Actions</th>
            </tr>
            </thead>
            <tbody>
            {% if hangouts is empty %}
            <tr>
                <td colspan="5">Aucune sortie trouvée.</td>
            </tr>
            {% else %}
                {% for hangout in hangouts %}

            <tr>
                <td>{{ hangout.name }}</td>
                <td>{{ hangout.startingDateTime|date('d M Y') }}</td>
                <td>{{ hangout.lastSubmitDate|date('d M Y') }}</td>
                <td>{{ hangout.subscriberLst|length }} / {{ hangout.maxParticipant }}</td>
                <td>{{ hangout.state.label }}</td>
                <td style="color: red; text-align: center"> {% if is_granted('POST_SUBSCRIBED', hangout) %}
                    X
                    {% endif %}
                </td>
                <td>
                    <a href="{{ path('user_detail', {'id': hangout.organizer.id}) }}">{{ hangout.organizer.username }}</a>
                </td>
                <td>
                    {% set actions = [] %}

                    {% if is_granted('POST_SUBSCRIBER', hangout) %}
                        {% set actions = actions|merge(['<a href="' ~ path('hangout_subscribe', {'id': hangout.id}) ~ '" class="contrast no-underline">S\'inscrire</a>']) %}
                    {% endif %}
                    {% if is_granted('POST_UNSUBSCRIBER', hangout) %}
                        {% set actions = actions|merge(['<a href="' ~ path('hangout_unsubscribe', {'id': hangout.id}) ~ '" class="contrast no-underline">Se désister</a>']) %}
                    {% endif %}
                    {% if not is_granted('POST_MODIFY', hangout) %}
                        {% set actions = actions|merge(['<a href="' ~ path('hangout_detail', {'id': hangout.id}) ~ '" class="contrast no-underline">Afficher</a>']) %}
                    {% endif %}
                    {% if is_granted('POST_MODIFY', hangout) %}
                        {% set actions = actions|merge(['<a href="' ~ path('hangout_modify', {'id': hangout.id}) ~ '" class="contrast no-underline">Modifier</a>']) %}
                    {% endif %}
                    {% if is_granted('POST_CANCEL', hangout) %}
                        {% set actions = actions|merge(['<a href="' ~ path('hangout_cancel', {'id': hangout.id}) ~ '" class="contrast no-underline">Annuler</a>']) %}
                    {% endif %}
                    {% if is_granted('POST_PUBLISH', hangout) %}
                        {% set actions = actions|merge(['<a href="' ~ path('hangout_publish', {'id': hangout.id}) ~ '" class="contrast no-underline">Publier</a>']) %}
                    {% endif %}

                    {{ actions|join(' - ')|raw }}
                </td>
            </tr>

                {% endfor %}
                {% endif %}
            </tbody>
        </table>


    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
{% endblock %}

{% block stylesheets %}
    {{ parent() }}
{% endblock %}
